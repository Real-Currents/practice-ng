<!DOCTYPE html 
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>Hello, AngularJS</title>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />

    <link rel="stylesheet" href="jquery/ui/themes/smoothness/jquery-ui.css" />
	
    <script type="text/javascript" src="jquery/jquery.min.js"></script>
    <script type="text/javascript" src="jquery/jquery.mobile.min.js"></script>
    <script type="text/javascript" src="angularjs/angular.min.js"></script>
</head>

<body data-role="page" ng-app="practice-angularjs">
    <div ng-controller='HelloController' 
		 style="text-align:center; margin:20px auto; max-width:240px; border-radius:12px 12px; border:4px solid rgba(25%,25%,25%,0.5);">
        <h1 data-role="header">{{greeting}} "{{usrmsg}}"</h1>
        You: <div class="practice-user-message"></div>
        <p>Keep Typing</p>
    </div>

    <script type="text/javascript">
		var practice = angular.module('practice-angularjs', []);
		var $inspectScope = {},
			$inspectThis = {};
		
        practice.controller( 'HelloController', function($scope) {
            $scope.greeting = "You said,";
			$scope.usrmsg = "";
			$scope.longmsg = false;

            $scope.transformField = function() {
			try {
                if ($scope.usrmsg.length > 10) {
					$scope.longmsg = true;
                } else {
                    $scope.longmsg = false;				
                }
			} catch (e) {
				console.log( "Failed to update usrmsg box: "+ e.stack );
			} finally {
				return $scope.longmsg;
			}
            }
        } );
		
		practice.directive( 'practiceUserMessage', function() {
			return {
				restrict: 	'C',
				replace: 	true,
				//transclude:	true,
				template: 	'<span>'+
								'<input ng-model="usrmsg" ng-change="transformField()" ng-hide="longmsg"></input>'+
								'<textarea ng-model="usrmsg" ng-change="transformField()" ng-show="longmsg"></textarea>'+
							'</span>',
				link: function( scope, element, attrs ) {
					var $lilBox = angular.element( element.children()[0] );
					var $bigBox = angular.element( element.children()[1] );
					scope.$watch(scope.transformField, function( n, o, scope ){
						if( n === o ) {
							return;
						} else if(! n ) {
							$lilBox[0].focus();
							$lilBox[0].selectionStart = 
								$lilBox[0].selectionEnd = 
								$lilBox[0].value.length;
						} else {
							$bigBox[0].focus();
							$bigBox[0].selectionStart = 
								$bigBox[0].selectionEnd = 
								$bigBox[0].value.length;
						}
					} );
				}
			};
		} );
    </script>
</body>

</html>
